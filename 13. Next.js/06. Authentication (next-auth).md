## Authentication (next-auth)

### What is NextAuth.js?

NextAuth.js is an authentication library for Next.js that provides:

- Secure login flows (OAuth, credentials, etc.)
- Session management (server & client)
- Built-in CSRF protection
- Works with both Pages Router and App Router.

---

### How It Works

You configure a `/api/auth/[...nextauth].js` API route.

NextAuth handles:

- Redirecting to a provider (e.g., Google, GitHub)
- Handling the OAuth callback
- Creating a secure session (stored in a cookie or JWT)
- Provides a React hook (`useSession`) for accessing auth state on the client.

---

### Basic Setup

```bash
npm install next-auth
```

**pages/api/auth/[...nextauth].js (Pages Router):**

```js
import NextAuth from 'next-auth';
import GoogleProvider from 'next-auth/providers/google';

export default NextAuth({
  providers: [
    GoogleProvider({
      clientId: process.env.GOOGLE_CLIENT_ID,
      clientSecret: process.env.GOOGLE_CLIENT_SECRET,
    }),
  ],
  session: {
    strategy: 'jwt',
  },
});
```

**Using in a component:**

```jsx
import { useSession, signIn, signOut } from 'next-auth/react';

export default function Home() {
  const { data: session } = useSession();

  if (!session) {
    return <button onClick={() => signIn('google')}>Sign in</button>;
  }

  return (
    <>
      <p>Signed in as {session.user.email}</p>
      <button onClick={() => signOut()}>Sign out</button>
    </>
  );
}
```

---

### Supported Auth Strategies

- **OAuth providers** — Google, GitHub, Facebook, Twitter, etc.
- **Credentials provider** — Username/password (custom logic)
- **Email provider** — Magic link authentication
- **Custom providers** — Your own OAuth/OpenID server

---

### How Sessions Work

- **JWT (default)** — Stored in cookies, signed & encrypted.
- **Database sessions** — Stored in DB for persistence across servers.
- Session is accessible in both Server Components and API routes.

---

### Security Features

- CSRF protection
- Secure cookies (`httpOnly`, `sameSite`, `secure`)
- Token rotation (for refresh tokens)
- Built-in provider security defaults

---

### Common Interview Questions

- How do you integrate Google login with NextAuth.js in Next.js?
- What’s the difference between JWT and database session storage in NextAuth?
- How do you protect a page so only authenticated users can see it?
- How does NextAuth handle security (CSRF, cookies)?
- How would you add a custom username/password authentication flow?
